{% extends 'base.html' %}

{% block head %}
  {%load static%}
  <link
    rel="stylesheet"
    type="text/css"
    href="{% static 'css/catalogos.css' %}"
  />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
  <title>Catalogo de observaciones</title>
{% endblock %}

{% block content %}
  <div class="all-cont animate__animated animate__fadeIn">
    <header class="header">
      <div class="logo">
        <img class="img-logo" src="{% static 'images/perro-galgo.png'%}" alt="logo" />
      </div>
      <h1 class="main-title">CATÁLOGO DE RECHAZOS</h1>
    </header>
    <main class="main-cont">
        <div class="cont-left">
          <header class="section-head">
            <h2 class="section-title">Agregar rechazo</h2>
          </header>
          {% include 'catalogos-forms/rechazo-form.html' %}
        </div>
        <div class="cont-right">
          <header class="section-head">
            <h2 class="section-title">Rechazo</h2>
          </header>
          <div class="table-cont">
            <table class="main-table">
              <thead>
                <tr>
                  <th>Acciones</th>
                  <th>Compañía</th>
                  <th>Razón</th>
                </tr>
              </thead>

              <tbody>
                {% for rechazo in rechazos %}
                  <tr id="{{rechazo.id}}">
                    <td class="flex-row">
                      <a href="{% url 'dashboards:catalogoRechazosEdit' rechazo.id %}" class="btn btn-download">
                        <span class="icon-pencil"></span>
                      </a>
                      <form action="{% url "dashboards:catalogoRechazosDelete" %}" class="delete-form" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="id" value="{{rechazo.id}}">
                        <button class="btn btn-danger">
                          <span class="icon-trash"></span>
                        </button>
                      </form>
                    </td>
                    <td>{{rechazo.compania}}</td>
                    <td>{{rechazo.razon}}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
    </main>
  </div>

  <script>
    document.addEventListener('submit', (e) => {
      if (e.target.matches('.delete-form')) {
        e.preventDefault();
        Swal.fire({
          title: '¿Esta seguro?',
          text: 'Esta acción eliminará al usuario de manera permanente',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Si',
          cancelButtonText: 'No',
        }).then((result) => {
          if (result.isConfirmed) {
            e.target.submit();
          } else {
            result.dismiss === Swal.DismissReason.cancel;
          }
        })
      }
    });
  </script>
{% endblock %}